---
phase: 07-admin-menu-content-management
plan: 03
type: execute
wave: 3
depends_on: [07-01, 07-02]
files_modified: [bot/states/admin.py]
autonomous: true

must_haves:
  truths:
    - "Admin puede iniciar wizard de creación de paquete"
    - "Wizard recopila datos paso a paso (nombre → tipo → precio → descripción)"
    - "Admin puede cancelar wizard en cualquier paso"
    - "Admin puede editar campos de paquetes existentes (inline prompt pattern)"
    - "FSM states se limpian correctamente al cancelar/completar"
  artifacts:
    - path: "bot/states/admin.py"
      provides: "ContentPackageStates FSM state group for creation wizard and inline editing"
      contains: "class ContentPackageStates(StatesGroup)"
      exports: ["waiting_for_name", "waiting_for_type", "waiting_for_price", "waiting_for_description", "waiting_for_edit"]
  key_links:
    - from: "bot/handlers/admin/content.py (plan 07-04)"
      to: "bot/states/admin.py"
      via: "ContentPackageStates state references"
      pattern: "ContentPackageStates\\.(waiting_for_name|waiting_for_type|waiting_for_price|waiting_for_description|waiting_for_edit)"
---

<objective>
Add ContentPackageStates FSM state group to bot/states/admin.py for multi-step content package creation wizard (name → type → price → description) and inline editing pattern (waiting_for_edit).

Purpose: Enable FSM-based wizard pattern for collecting package data step-by-step with validation at each stage, and inline editing for updating existing package fields, following existing PricingSetupStates pattern from admin.py.
Output: ContentPackageStates StatesGroup with 5 states for wizard flow + inline editing.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-admin-menu-content-management/07-CONTEXT.md
@.planning/phases/07-admin-menu-content-management/07-RESEARCH.md

@bot/states/admin.py
@.planning/phases/07-admin-menu-content-management/07-01-PLAN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ContentPackageStates FSM state group</name>
  <files>bot/states/admin.py</files>
  <action>
Add ContentPackageStates class to bot/states/admin.py after PricingSetupStates:

1. Add at end of file (after PricingSetupStates class):

```python
class ContentPackageStates(StatesGroup):
    """
    Estados para creación de paquetes de contenido.

    Flujo de creación:
    1. Admin selecciona "Crear Paquete"
    2. Bot entra en waiting_for_name
    3. Admin envía nombre: "Colección Verano"
    4. Bot entra en waiting_for_type
    5. Admin selecciona tipo con botones: [VIP Premium] [VIP Content] [Free Content]
    6. Bot entra en waiting_for_price
    7. Admin envía precio o /skip: "9.99" o "/skip"
    8. Bot entra en waiting_for_description
    9. Admin envía descripción o /skip: "Contenido exclusivo..."
    10. Bot crea paquete y sale del estado

    Flujo de edición (inline prompt pattern):
    1. Admin abre detalle de paquete existente
    2. Admin selecciona campo a editar: [Editar nombre] [Editar precio] [Editar descripción]
    3. Bot entra en waiting_for_edit
    4. Admin envía nuevo valor o /skip para mantener actual
    5. Bot actualiza campo y vuelve a vista detalle

    Validación:
    - Nombre: No vacío, máximo 200 caracteres
    - Tipo: Debe seleccionar con botones (3 opciones), NO editable post-creación
    - Precio: Opcional, si se envía debe ser número >= 0
    - Descripción: Opcional, texto libre
    - /skip: Permite omitir campos opcionales (creación) o mantener valor actual (edición)
    - Cancelar: Vuelve al menú principal sin guardar

    Estados:
    - waiting_for_name: Esperando nombre del paquete (texto) - CREACIÓN
    - waiting_for_type: Esperando tipo de paquete (botones inline) - CREACIÓN
    - waiting_for_price: Esperando precio (número o /skip) - CREACIÓN
    - waiting_for_description: Esperando descripción (texto o /skip) - CREACIÓN
    - waiting_for_edit: Esperando nuevo valor de campo (inline prompt) - EDICIÓN
    """

    # ===== CREACIÓN (4-step wizard) =====

    # Paso 1: Esperando nombre del paquete (required)
    waiting_for_name = State()

    # Paso 2: Esperando tipo de paquete via botones inline (required)
    waiting_for_type = State()

    # Paso 3: Esperando precio del paquete (optional, /skip to omit)
    waiting_for_price = State()

    # Paso 4: Esperando descripción del paquete (optional, /skip to omit)
    waiting_for_description = State()

    # ===== EDICIÓN (inline prompt pattern) =====

    # Para editar campos de paquetes existentes (name, price, description)
    waiting_for_edit = State()  # For inline prompt editing
```

2. Pattern reference: Follow PricingSetupStates structure (lines 112-142 in existing admin.py)

DO NOT:
- Modify existing FSM state classes (ChannelSetupStates, WaitTimeSetupStates, etc.)
- Add extra states beyond the 5 defined
- Change state naming convention (waiting_for_*)
- Add FSM logic (handlers in plan 07-04)
  </action>
  <verify>
1. ContentPackageStates class added to bot/states/admin.py
2. Has 5 states: waiting_for_name, waiting_for_type, waiting_for_price, waiting_for_description, waiting_for_edit
3. Extends StatesGroup
4. Has comprehensive docstring with creation AND editing flow description
5. Follows PricingSetupStates pattern
6. Existing FSM state classes unchanged
7. waiting_for_edit state documented for inline prompt pattern
  </verify>
  <done>
ContentPackageStates FSM state group created with 5 states for content package creation wizard + inline editing.
  </done>
</task>

</tasks>

<verification>
Overall phase verification:
1. ContentPackageStates class exists in bot/states/admin.py
2. Has 5 State objects defined (4 for creation + 1 for editing)
3. Docstring explains wizard flow AND inline editing flow completely
4. Follows existing FSM state pattern (PricingSetupStates)
5. No existing states modified
6. waiting_for_edit state supports plan 07-04 edit handlers
</verification>

<success_criteria>
1. FSM states can be imported: from bot.states.admin import ContentPackageStates
2. States are accessible: ContentPackageStates.waiting_for_name, etc.
3. States ready for handler integration (plan 07-04):
   - Creation wizard: waiting_for_name, waiting_for_type, waiting_for_price, waiting_for_description
   - Inline editing: waiting_for_edit
</success_criteria>

<output>
After completion, create `.planning/phases/07-admin-menu-content-management/07-03-SUMMARY.md`
</output>
