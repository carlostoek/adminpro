---
wave: 2
depends_on: ["21-02", "21-04"]
files_modified:
  - bot/services/message/user_menu.py
  - bot/handlers/user/menu.py
autonomous: false
---

# 21-05: Streak Display in User Menu

## Goal
Display current streak in user menu (VIP/Free) with fire emoji and day count (STREAK-05).

## Tasks

<task>
Update bot/services/message/user_menu.py

Add streak display to VIP menu:
- Show "ğŸ”¥ {streak} dÃ­as" in menu header or stats section
- Show "Reclamar regalo diario" button when available
- Show "â³ PrÃ³ximo regalo en {time}" when already claimed
</task>

<task>
Add streak display to Free menu:
- Same format as VIP menu
- Consistent streak display across user types
</task>

<task>
Implement _format_streak_display(streak_count) helper
- Returns "ğŸ”¥ {count} dÃ­as" if streak > 0
- Returns "ğŸ”¥ Sin racha" if streak == 0
- Uses guia-estilo.md voice guidelines
</task>

<task>
Update vip_menu_greeting() method signature
- Add streak_info parameter (dict with current_streak, can_claim, next_claim_time)
- Display streak in menu text
- Add daily gift button based on can_claim
</task>

<task>
Update free_menu_greeting() method signature
- Add streak_info parameter
- Display streak in menu text
- Add daily gift button based on can_claim
</task>

<task>
Update bot/handlers/user/menu.py
- Query streak info via container.streak.get_streak_info()
- Pass streak_info to menu message methods
- Handle case where user has no streak yet
</task>

<task>
Add streak reminder when at risk
- If user hasn't claimed today and streak > 0:
- Show subtle reminder: "ğŸ”¥ Reclame hoy para mantener su racha de {streak} dÃ­as"
</task>

## Verification
- [ ] User menu shows current streak with ğŸ”¥ emoji
- [ ] Daily gift button appears when claim is available
- [ ] Countdown appears when already claimed today
- [ ] Streak display works for both VIP and Free users
- [ ] Streak reminder shows when at risk of losing streak

## Must-Haves for Goal-Backward Verification
1. Streak displayed in user menu (STREAK-05)
2. Fire emoji with day count format: "ğŸ”¥ 5 dÃ­as"
3. Button placement in main user menu
