---
wave: 1
depends_on: ["21-02"]
files_modified:
  - bot/services/streak.py
autonomous: false
---

# 21-03: Reaction Streak Tracking

## Goal
Implement separate reaction streak tracking that counts consecutive days with reactions (STREAK-06).

## Tasks

<task>
Implement record_reaction(user_id, reaction_date=None) method in StreakService
- Called when user adds a reaction to content
- Gets or creates REACTION type streak for user
- Checks if reaction is on a new day (UTC)
- If new day: increment streak, update last_reaction_date
- If same day: no streak change (already counted for today)
- Returns (streak_incremented: bool, new_streak: int)
</task>

<task>
Implement get_reaction_streak(user_id) method
- Returns current reaction streak for user
- Returns 0 if no streak exists
</task>

<task>
Update ReactionService to integrate with StreakService
- Modify bot/services/reaction.py
- Inject streak_service in constructor
- Call streak_service.record_reaction() when reaction is successfully added
- Only count reactions that earn besitos (not rate-limited ones)
</task>

<task>
Update ServiceContainer.reaction property
- Pass streak_service when creating ReactionService
- Ensure proper lazy loading order
</task>

## Verification
- [ ] Reaction streak increments on first reaction of each day
- [ ] Multiple reactions same day don't increment streak multiple times
- [ ] Reaction streak tracks separately from daily gift streak
- [ ] Reaction streak resets after missing a day (handled by background job)

## Must-Haves for Goal-Backward Verification
1. Reaction streak tracks separately from daily gift streak (STREAK-06)
2. Consecutive days with reactions increment the streak
3. Integration with ReactionService works
