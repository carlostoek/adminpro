---
wave: 1
depends_on: []
files_modified:
  - bot/database/models.py
  - bot/database/enums.py
autonomous: false
---

# 21-01: Database Model - UserStreak

## Goal
Create the UserStreak database model to track daily gift claims and reaction streaks for users.

## Tasks

<task>
Add StreakType enum to bot/database/enums.py
- DAILY_GIFT: For daily gift claim streaks
- REACTION: For consecutive days with reactions streaks
</task>

<task>
Create UserStreak model in bot/database/models.py

Fields:
- id: Integer PK
- user_id: BigInteger FK to users.user_id (unique per type)
- streak_type: Enum(StreakType) - DAILY_GIFT or REACTION
- current_streak: Integer default 0
- longest_streak: Integer default 0
- last_claim_date: DateTime nullable (UTC date of last claim)
- last_reaction_date: DateTime nullable (for reaction streak)
- created_at: DateTime default utcnow
- updated_at: DateTime default utcnow onupdate

Indexes:
- idx_user_streak_type: unique on (user_id, streak_type)
- idx_streak_type_current: composite on (streak_type, current_streak) for leaderboards
</task>

<task>
Update BotConfig model with streak configuration
Add fields:
- besitos_daily_base: Integer default 20 (base besitos for daily claim)
- besitos_streak_bonus_per_day: Integer default 2
- besitos_streak_bonus_max: Integer default 50
- streak_display_format: String default "ðŸ”¥ {days} days"
</task>

<task>
Create database migration (if using migrations) or ensure model is registered
- Import UserStreak in bot/database/__init__.py
</task>

## Verification
- [ ] UserStreak model can be imported
- [ ] StreakType enum has DAILY_GIFT and REACTION values
- [ ] Unique constraint on (user_id, streak_type) works
- [ ] Model has proper __repr__ method

## Must-Haves for Goal-Backward Verification
1. UserStreak model exists with all required fields
2. StreakType enum distinguishes daily gift from reaction streaks
3. Database can store streak state per user
