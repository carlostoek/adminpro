---
phase: 18-admin-test-runner-&-performance-profiling
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/run_tests.py
autonomous: true
must_haves:
  truths:
    - "Running `python scripts/run_tests.py` executes pytest and displays formatted results without freezing"
    - "Pytest subprocess does not inherit parent's stdin"
  artifacts:
    - path: "scripts/run_tests.py"
      provides: "CLI test runner with fixed stdin handling"
      change: "Add stdin=asyncio.subprocess.DEVNULL to create_subprocess_exec()"
  key_links:
    - from: "scripts/run_tests.py:108-113"
      to: "asyncio.subprocess.DEVNULL"
      via: "stdin parameter"
---

<objective>
Fix CLI test runner freeze issue by preventing pytest from waiting for stdin input.

Purpose: The test runner hangs indefinitely when executed because pytest inherits the parent's stdin and may wait for user input in TTY environments.
Output: scripts/run_tests.py with stdin=asyncio.subprocess.DEVNULL added to subprocess creation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@scripts/run_tests.py
</context>

<tasks>

<task type="auto">
  <name>Fix stdin handling in test runner subprocess</name>
  <files>scripts/run_tests.py</files>
  <action>
    Modify the `asyncio.create_subprocess_exec()` call at lines 108-113 to add `stdin=asyncio.subprocess.DEVNULL`.

    Current code (lines 108-113):
    ```python
    proc = await asyncio.create_subprocess_exec(
        *cmd,
        stdout=asyncio.subprocess.PIPE,
        stderr=asyncio.subprocess.PIPE,
        cwd=self.project_root
    )
    ```

    Fixed code:
    ```python
    proc = await asyncio.create_subprocess_exec(
        *cmd,
        stdout=asyncio.subprocess.PIPE,
        stderr=asyncio.subprocess.PIPE,
        stdin=asyncio.subprocess.DEVNULL,
        cwd=self.project_root
    )
    ```

    This prevents pytest from inheriting the parent's stdin, which was causing the freeze when pytest waited for user input.
  </action>
  <verify>
    Run the test runner to verify it no longer hangs:
    ```bash
    timeout 30 python scripts/run_tests.py --help
    timeout 30 python scripts/run_tests.py tests/test_database/
    ```
    Both commands should complete within 30 seconds without hanging.
  </verify>
  <done>
    - scripts/run_tests.py contains `stdin=asyncio.subprocess.DEVNULL` in the create_subprocess_exec() call
    - Running `python scripts/run_tests.py` completes without freezing
    - Test output displays formatted results with pass/fail counts and emojis
  </done>
</task>

</tasks>

<verification>
- [ ] File scripts/run_tests.py has been modified
- [ ] Line 112 contains `stdin=asyncio.subprocess.DEVNULL,`
- [ ] Running `python scripts/run_tests.py` completes successfully without hanging
- [ ] Output shows formatted test results with emojis
</verification>

<success_criteria>
- The test runner executes pytest without waiting for stdin input
- Formatted results display correctly with pass/fail counts, duration, and emojis
- No indefinite hang occurs when running the script
</success_criteria>

<output>
After completion, create `.planning/phases/18-admin-test-runner-&-performance-profiling/18-05-SUMMARY.md`
</output>
