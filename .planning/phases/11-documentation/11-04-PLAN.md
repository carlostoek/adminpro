---
phase: 11-documentation
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/EXAMPLES.md
autonomous: true

must_haves:
  truths:
    - "EXAMPLES.md exists with practical usage examples of the menu system"
    - "Examples cover common use cases (admin management, user menus, content display)"
    - "Code examples are complete and runnable"
    - "Examples demonstrate Lucien's voice integration"
    - "Testing examples included"
  artifacts:
    - path: "docs/EXAMPLES.md"
      provides: "Usage examples for menu system"
      min_lines: 200
      contains: ["Admin Menu Example", "User Menu Example", "Content Management", "Testing", "Voice Integration"]
  key_links:
    - from: "docs/EXAMPLES.md"
      to: "bot/services/message/*.py"
      via: "Message provider usage examples"
      pattern: "Example usage of message providers"
    - from: "docs/EXAMPLES.md"
      to: "bot/handlers/**/*.py"
      via: "Handler implementation examples"
      pattern: "Complete handler examples"
---

<objective>
Create practical usage examples demonstrating the menu system in action.

Purpose: Provide developers with real-world examples of how to use the menu system for common tasks, with complete runnable code.
Output: 200+ line example documentation with working code samples.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@docs/MENU_SYSTEM.md
@docs/INTEGRATION_GUIDE.md
@docs/guia-estilo.md

# Existing implementations for reference
@bot/handlers/admin/content.py
@bot/handlers/vip/menu.py
@bot/handlers/free/menu.py
@bot/services/message/admin_content.py
@bot/services/message/user_menu.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EXAMPLES.md with Common Use Cases</name>
  <files>
    docs/EXAMPLES.md
  </files>
  <action>
    Create comprehensive examples documentation for menu system usage:

    **File structure:**
    ```markdown
    # Ejemplos de Uso - Sistema de Men√∫s

    ## Overview
    - What this document covers
    - How to use these examples
    - Prerequisites

    ## Example 1: Simple Admin Menu
    - Use case: Admin needs to manage a simple list
    - Message provider implementation
    - Handler implementation
    - Testing the example

    ## Example 2: User Menu with Role Detection
    - Use case: Different menus for VIP vs Free users
    - Role-based message provider
    - Callback handling
    - Expected behavior

    ## Example 3: Content Package Display
    - Use case: Display paginated content list
    - Pagination implementation
    - Keyboard navigation
    - Detail view

    ## Example 4: Form Input with FSM
    - Use case: Collect multi-step user input
    - FSM state definition
    - Step-by-step handlers
    - State cleanup

    ## Example 5: Interest Registration System
    - Use case: User clicks "Me interesa" button
    - Interest creation
    - Admin notification
    - Debounce logic

    ## Example 6: Testing Message Providers
    - Unit test structure
    - Mocking dependencies
    - Testing variations
    - Testing keyboards

    ## Example 7: Voice Integration Patterns
    - Adding Lucien's voice to messages
    - Weighted variations
    - Session-aware selection
    - Voice linting

    ## Common Patterns Reference
    - Navigation patterns (back, exit)
    - Confirmation dialogs
    - Empty states
    - Error handling
    ```

    **Content requirements:**
    - Write in Spanish (consistent with project)
    - Each example must be complete and runnable
    - Show both message provider AND handler code
    - Include expected output/behavior
    - Add notes about Lucien's voice usage
    - Reference MENU_SYSTEM.md for architecture details

    **Each example should include:**
    - Problem statement (use case)
    - Solution approach
    - Complete code (message provider + handler)
    - Expected behavior description
    - Testing instructions
    - Notes and variations

    **Write in Spanish**
  </action>
  <verify>
    wc -l docs/EXAMPLES.md
    grep -c "##" docs/EXAMPLES.md
  </verify>
  <done>
    EXAMPLES.md exists with:
    - 200+ lines of documentation
    - 7+ complete examples
    - Each example has runnable code
    - Expected behavior documented
    - Testing instructions included
  </done>
</task>

<task type="auto">
  <name>Task 2: Document Admin Menu Example</name>
  <files>
    docs/EXAMPLES.md
  </files>
  <action>
    Add complete admin menu example to EXAMPLES.md:

    **Section: Ejemplo 1 - Men√∫ de Administraci√≥n Simple**
    ```markdown
    ## Ejemplo 1: Men√∫ de Administraci√≥n Simple

    ### Caso de Uso
    El admin necesita gestionar una lista de configuraciones simples.
    El men√∫ debe mostrar todas las opciones, permitir editarlas,
    y mantener la voz de Lucien.

    ### Message Provider
    ```python
    # bot/services/message/admin_settings.py
    from typing import List, Tuple
    from aiogram.types import InlineKeyboardMarkup
    from aiogram.utils.keyboard import InlineKeyboardBuilder
    from bot.services.message.base import BaseMessageProvider
    from bot.services.message.common import CommonMessages

    class AdminSettingsMessages(BaseMessageProvider):
        """Mensajes para men√∫ de configuraci√≥n.

        Voice Pattern:
            - Formal y colaborativo
            - Usa "custodio" para dirigirse al admin
            - Terminolog√≠a: "ajustes", "configuraci√≥n"

        Example:
            >>> provider = AdminSettingsMessages()
            >>> text, keyboard = provider.settings_list(settings)
        """

        def __init__(self):
            super().__init__()
            self.common = CommonMessages()

        def settings_list(
            self,
            settings: List[dict]
        ) -> Tuple[str, InlineKeyboardMarkup]:
            """Generate settings list view.

            Args:
                settings: List of setting dicts

            Returns:
                Tuple of (message_text, keyboard_markup)
            """
            if not settings:
                text = self.common.empty_list(
                    context="configuraciones",
                    suggestion="Usa /add_setting para crear una"
                )
                return text, self._empty_keyboard()

            # Voice variations with weights
            text_variations = [
                (60, "Custodio, aqu√≠ tienes los ajustes del sistema:"),
                (30, "Configuraci√≥n actual del sanctum, custodio:"),
                (10, "Los par√°metros que definen nuestra operaci√≥n:"),
            ]

            text = self._select_variation(text_variations)
            text += "\n\n" + self._format_settings(settings)

            keyboard = self._settings_keyboard(settings)
            return text, keyboard

        def _format_settings(self, settings: List[dict]) -> str:
            """Format settings list."""
            lines = []
            for setting in settings:
                status = "‚úÖ" if setting["active"] else "‚ùå"
                lines.append(f"{status} <b>{setting['name']}</b>: {setting['value']}")
            return "\n".join(lines)

        def _settings_keyboard(self, settings: List[dict]) -> InlineKeyboardMarkup:
            builder = InlineKeyboardBuilder()

            for setting in settings:
                builder.button(
                    text=f"‚öôÔ∏è {setting['name']}",
                    callback_data=f"admin:settings:edit:{setting['id']}"
                )

            # Navigation row
            builder.row(
                InlineKeyboardButton(text="‚ûï Agregar", callback_data="admin:settings:add"),
                InlineKeyboardButton(text="üîô Volver", callback_data="admin:menu:back"),
            )
            builder.row(
                InlineKeyboardButton(text="‚ùå Salir", callback_data="admin:menu:exit"),
            )

            return builder.as_markup()

        def _empty_keyboard(self) -> InlineKeyboardMarkup:
            builder = InlineKeyboardBuilder()
            builder.row(
                InlineKeyboardButton(text="‚ûï Crear primer ajuste", callback_data="admin:settings:add"),
                InlineKeyboardButton(text="üîô Volver", callback_data="admin:menu:back"),
            )
            return builder.as_markup()
    ```

    ### Handler Implementation
    ```python
    # bot/handlers/admin/settings.py
    from aiogram import Router, F, types
    from aiogram.filters import Command
    from sqlalchemy.ext.asyncio import AsyncSession

    from bot.database.models import UserRole
    from bot.services import ServiceContainer
    from bot.services.message.admin_settings import AdminSettingsMessages
    from bot.middlewares.database import DatabaseMiddleware

    settings_router = Router()
    settings_router.message.middleware(DatabaseMiddleware())
    settings_router.callback_query.middleware(DatabaseMiddleware())

    @settings_router.message(Command("settings"))
    async def cmd_settings(
        message: types.Message,
        session: AsyncSession,
        user_role: UserRole
    ):
        """Handle /settings command."""
        if user_role != UserRole.ADMIN:
            await message.answer("‚ùå Solo administradores.")
            return

        container = ServiceContainer(session, message.bot)
        messages = AdminSettingsMessages()

        # Get settings from database
        settings = await container.settings.get_all()

        # Generate and send message
        text, keyboard = messages.settings_list(settings)
        await message.answer(text, reply_markup=keyboard)

    @settings_router.callback_query(F.data.startswith("admin:settings:edit:"))
    async def callback_edit_setting(
        callback: types.CallbackQuery,
        session: AsyncSession
    ):
        """Handle edit setting callback."""
        await callback.answer()

        parts = callback.data.split(":")
        setting_id = int(parts[3])

        container = ServiceContainer(session, callback.bot)
        setting = await container.settings.get_by_id(setting_id)

        if not setting:
            await callback.message.edit_text("‚ùå Ajuste no encontrado")
            return

        # Show edit interface
        await callback.message.edit_text(
            f"Editando: <b>{setting.name}</b>\n"
            f"Valor actual: {setting.value}\n\n"
            f"Env√≠a el nuevo valor:",
            reply_markup=None
        )

        # Set FSM state for next message
        # ... (FSM state management)
    ```

    ### Comportamiento Esperado
    1. Admin env√≠a /settings
    2. Bot responde con lista de ajustes (voz de Lucien)
    3. Admin puede editar ajustes existentes
    4. Bot muestra confirmaci√≥n despu√©s de guardar
    5. Navegaci√≥n: Volver al men√∫ principal, Salir para cerrar

    ### Testing
    ```bash
    # 1. Iniciar el bot
    python main.py

    # 2. Enviar /settings como admin
    # 3. Verificar que se muestra la lista
    # 4. Clic en bot√≥n de editar
    # 5. Enviar nuevo valor
    # 6. Verificar que se guarda
    # 7. Probar navegaci√≥n (Volver, Salir)
    ```

    ### Notas
    - Usa CommonMessages para estados vac√≠os
    - Variaciones de voz con pesos (60/30/10)
    - Keyboard sigue patr√≥n de navegaci√≥n est√°ndar
    - FSM states para multi-step input
    ```

    **Add to existing EXAMPLES.md file**
  </action>
  <verify>
    grep -c "Ejemplo 1" docs/EXAMPLES.md
    grep -c "AdminSettingsMessages" docs/EXAMPLES.md
  </verify>
  <done>
    Admin menu example includes:
    - Complete message provider implementation
    - Complete handler implementation
    - Expected behavior documented
    - Testing instructions
    - Notes about voice integration
  </done>
</task>

<task type="auto">
  <name>Task 3: Document User Menu with Role Detection Example</name>
  <files>
    docs/EXAMPLES.md
  </files>
  <action>
    Add complete user menu example to EXAMPLES.md:

    **Section: Ejemplo 2 - Men√∫ de Usuario con Detecci√≥n de Rol**
    ```markdown
    ## Ejemplo 2: Men√∫ de Usuario con Detecci√≥n de Rol

    ### Caso de Uso
    Usuarios VIP y Free necesitan men√∫s diferentes.
    VIP ve contenido premium, Free ve contenido b√°sico
    con informaci√≥n sobre c√≥mo acceder a VIP.

    ### Message Provider
    ```python
    # bot/services/message/user_content.py
    from typing import Tuple
    from aiogram.types import InlineKeyboardMarkup
    from bot.database.enums import UserRole
    from bot.services.message.base import BaseMessageProvider
    from bot.services.message.common import CommonMessages

    class UserContentMessages(BaseMessageProvider):
        """Mensajes para men√∫ de contenido por rol.

        Voice Pattern:
            - VIP: "c√≠rculo exclusivo", "tesoros"
            - Free: "jard√≠n p√∫blico", "muestras"

        Example:
            >>> provider = UserContentMessages()
            >>> text, keyboard = provider.content_menu(
            ...     user_role=UserRole.VIP,
            ...     user_name="Diana"
            ... )
        """

        def __init__(self):
            super().__init__()
            self.common = CommonMessages()

        def content_menu(
            self,
            user_role: UserRole,
            user_name: str,
            content_count: int
        ) -> Tuple[str, InlineKeyboardMarkup]:
            """Generate role-specific content menu.

            Args:
                user_role: VIP or FREE
                user_name: User's first name
                content_count: Available content items

            Returns:
                Tuple of (message_text, keyboard_markup)
            """
            if user_role == UserRole.VIP:
                return self._vip_menu(user_name, content_count)
            else:
                return self._free_menu(user_name, content_count)

        def _vip_menu(self, user_name: str, count: int) -> Tuple[str, InlineKeyboardMarkup]:
            """VIP member menu."""
            text_variations = [
                (70, f"Bienvenido al c√≠rculo, {user_name}. Los tesoros te esperan."),
                (20, f"{user_name}, el sanctum abre sus puertas para ti."),
                (10, f"El c√≠rculo reconoce tu presencia, {user_name}."),
            ]

            text = self._select_variation(text_variations)
            text += f"\n\nüì¶ Contenido disponible: <b>{count}</b> tesoros"

            keyboard = self._vip_keyboard()
            return text, keyboard

        def _free_menu(self, user_name: str, count: int) -> Tuple[str, InlineKeyboardMarkup]:
            """Free user menu."""
            text_variations = [
                (70, f" Bienvenido al jard√≠n, {user_name}. Disfruta las muestras."),
                (20, f"{user_name}, te invitamos a explorar lo que ofrecemos."),
                (10, f"El jard√≠n te recibe, {user_name}."),
            ]

            text = self._select_variation(text_variations)
            text += f"\n\nüì¶ Contenido gratuito: <b>{count}</b> muestras"
            text += "\n\nüíé <i>Los tesoros completos esperan en el c√≠rculo exclusivo.</i>"

            keyboard = self._free_keyboard()
            return text, keyboard

        def _vip_keyboard(self) -> InlineKeyboardMarkup:
            """VIP member keyboard."""
            builder = InlineKeyboardBuilder()

            builder.button(text="üíé Tesoros", callback_data="user:content:list:premium")
            builder.button(text="üìä Mi Suscripci√≥n", callback_data="user:vip:subscription")
            builder.button(text="üéÅ Bonus", callback_data="user:content:list:bonus")

            # Navigation
            builder.row(
                InlineKeyboardButton(text="üîô Volver", callback_data="user:menu:back"),
                InlineKeyboardButton(text="‚ùå Salir", callback_data="user:menu:exit"),
            )

            return builder.as_markup()

        def _free_keyboard(self) -> InlineKeyboardMarkup:
            """Free user keyboard."""
            builder = InlineKeyboardBuilder()

            builder.button(text="üå∑ Muestras", callback_data="user:content:list:free")
            builder.button(text="üíé Acceder al C√≠rculo", callback_data="user:vip:join")

            # Navigation
            builder.row(
                InlineKeyboardButton(text="üîô Volver", callback_data="user:menu:back"),
                InlineKeyboardButton(text="‚ùå Salir", callback_data="user:menu:exit"),
            )

            return builder.as_markup()
    ```

    ### Handler Implementation
    ```python
    # bot/handlers/user/content.py
    from aiogram import Router, F, types
    from aiogram.filters import Command
    from sqlalchemy.ext.asyncio import AsyncSession

    from bot.database.models import UserRole
    from bot.database.enums import UserRole as UserRoleEnum
    from bot.services import ServiceContainer
    from bot.services.message.user_content import UserContentMessages
    from bot.middlewares.database import DatabaseMiddleware

    content_router = Router()
    content_router.message.middleware(DatabaseMiddleware())
    content_router.callback_query.middleware(DatabaseMiddleware())

    @content_router.message(Command("content"))
    async def cmd_content(
        message: types.Message,
        session: AsyncSession,
        user_role: UserRoleEnum
    ):
        """Handle /content command - role-based menu."""
        container = ServiceContainer(session, message.bot)
        messages = UserContentMessages()

        # Get content count based on role
        if user_role == UserRoleEnum.VIP:
            count = await container.content.count_premium()
        else:
            count = await container.content.count_free()

        # Generate role-specific menu
        text, keyboard = messages.content_menu(
            user_role=user_role,
            user_name=message.from_user.first_name,
            content_count=count
        )

        await message.answer(text, reply_markup=keyboard)

    @content_router.callback_query(F.data.startswith("user:content:list:"))
    async def callback_content_list(
        callback: types.CallbackQuery,
        session: AsyncSession,
        user_role: UserRoleEnum
    ):
        """Handle content list callback."""
        await callback.answer()

        parts = callback.data.split(":")
        content_type = parts[3]  # "premium", "free", "bonus"

        container = ServiceContainer(session, callback.bot)

        # Get content based on type and role
        if content_type == "premium" and user_role == UserRoleEnum.VIP:
            content = await container.content.get_premium()
        elif content_type == "free":
            content = await container.content.get_free()
        elif content_type == "bonus" and user_role == UserRoleEnum.VIP:
            content = await container.content.get_bonus()
        else:
            await callback.answer("‚ùå Contenido no disponible", show_alert=True)
            return

        # Show content list
        text = self._format_content_list(content)
        # ... send message
    ```
    ```

    ### Comportamiento Esperado
    **Usuario VIP:**
    1. Env√≠a /content
    2. Ve men√∫ con "Tesoros", "Mi Suscripci√≥n", "Bonus"
    3. Terminolog√≠a: "c√≠rculo", "tesoros", "sanctum"
    4. Puede acceder a contenido premium

    **Usuario Free:**
    1. Env√≠a /content
    2. Ve men√∫ con "Muestras", "Acceder al C√≠rculo"
    3. Terminolog√≠a: "jard√≠n", "muestras"
    4. Bot√≥n "Acceder al C√≠rculo" muestra info VIP

    ### Testing
    ```bash
    # Test como VIP
    /content
    # Verificar men√∫ VIP
    # Probar bot√≥n "Tesoros"

    # Test como Free
    /content
    # Verificar men√∫ Free
    # Probar bot√≥n "Acceder al C√≠rculo"
    ```

    ### Notas
    - UserRoleDetectionMiddleware inyecta user_role autom√°ticamente
    - Diferente terminolog√≠a por rol
    - Diferentes opciones de men√∫
    - Validaci√≥n de permisos en callbacks
    ```

    **Add to existing EXAMPLES.md file**
  </action>
  <verify>
    grep -c "Ejemplo 2" docs/EXAMPLES.md
    grep -c "UserRole" docs/EXAMPLES.md
  </verify>
  <done>
    User menu example includes:
    - Role-based message provider
    - Role-specific keyboard generation
    - Handler with role detection
    - Expected behavior for VIP and Free
    - Testing instructions
  </done>
</task>

</tasks>

<verification>
After completion, verify:
1. EXAMPLES.md exists and is 200+ lines
2. Multiple complete examples included
3. Each example has runnable code
4. Expected behavior documented
5. Testing instructions provided
6. Voice integration patterns shown
7. Written in Spanish
</verification>

<success_criteria>
1. File exists with 200+ lines
2. grep -c "##" returns 8+ example sections
3. Each example has complete provider + handler code
4. Examples cover admin, VIP, and Free use cases
5. Developer can copy-paste and run examples
</success_criteria>

<output>
After completion, create `.planning/phases/11-documentation/11-04-SUMMARY.md`
</output>
